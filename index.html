<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1.0">
    <title>easySQL - Gesti√≥n de Bases de Datos Simplificada</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/alasql@1.7.2/dist/alasql.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.0/dist/vis-network.min.js"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="scripts/textFormatter.js"></script>
    <script src="scripts/editFormFormatter.js"></script>
    <link rel="stylesheet" href="styles/checkboxes.css">
    <link rel="icon" type="image/png" href="styles/eSQLlogo.png">
    <!-- Google Fonts - Inter para un look m√°s moderno -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .insertion-subtitle {
            font-weight: 600;
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-xs);
            border-bottom: 2px solid var(--color-border);
            text-align: left;
            font-size: var(--font-size-lg);
            color: var(--color-primary);
        }
        #top-bar {
            padding: 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <h2>Iniciar Sesi√≥n</h2>
            <div class="role-selector">
                <button class="role-btn active" data-role="developer">Desarrollador</button>
                <button class="role-btn" data-role="admin">Administrador</button>
            </div>
            <form id="loginForm" onsubmit="return handleLogin(event)">
                <div class="login-field">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" required>
                </div>
                <div class="login-field">
                    <label for="password">Contrase√±a</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="login-button">Acceder</button>
            </form>
            <div class="guest-access">
                <button onclick="accessAsGuest()" class="guest-button">
                    Acceder como Invitado
                </button>
            </div>
        </div>
    </div>
    <div class="top-bar">
        <span id="datetime"></span>
        <div class="top-buttons">
            <button id="colorPickerBtn" class="top-btn">
                <img src="styles/color.png" alt="Color Theme">
            </button>
            <button class="top-btn" onclick="document.getElementById('sqlFileInput').click()">
                <img src="styles/cargarSQL.png" alt="Cargar SQL">
            </button>
            <button class="top-btn" onclick="downloadSQL()">
                <img src="styles/descargarSQL.png" alt="Descargar SQL">
            </button>
            <button class="top-btn" onclick="document.getElementById('insertionsFileInput').click()">
                <img src="styles/cargarINS.png" alt="Cargar Inserciones">
            </button>
            <button class="top-btn" onclick="downloadInsertions()">
                <img src="styles/descargarINS.png" alt="Descargar Inserciones">
            </button>
            <button id="helpBtn" class="top-btn">
                <img src="styles/eSQL.png" alt="easySQL Guide" class="header-logo">
            </button>
            <!-- El bot√≥n para subir .esql se ha movido al panel de personalizaci√≥n -->
        </div>
        <div id="colorPickerPanel" class="color-picker-panel">
            <h2 class="settings-title">PERSONALIZACI√ìN</h2>
            <div class="settings-section">
                <h3 class="section-title">Color de Fondo</h3>
                <!-- Eliminar el slider y gradiente -->
                <!-- <div class="color-slider-container">
                    <input type="range" id="colorSlider" min="0" max="100" value="100">
                    <div class="color-gradient"></div>
                </div> -->
                <!-- A√±adir switch modo oscuro -->
                <div class="switch-container" style="margin-top:1rem;">
                    <span class="switch-label">Modo oscuro</span>
                    <label class="switch">
                        <input type="checkbox" id="darkModeSwitch" checked="false">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="settings-section">
                <h3 class="section-title">Animaciones</h3>
                <div class="animation-switches">
                    <div class="switch-container">
                        <span class="switch-label">T√≠tulo flotante</span>
                        <label class="switch">
                            <input type="checkbox" id="titleAnimation" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="switch-container">
                        <span class="switch-label">Part√≠culas</span>
                        <label class="switch">
                            <input type="checkbox" id="particlesAnimation" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="switch-container">
                        <span class="switch-label">Fondo</span>
                        <label class="switch">
                            <input type="checkbox" id="circlesAnimation" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="shapesSection" class="settings-section" style="display: none;">
                <h3 class="section-title">Formas de fondo</h3>
                <div class="shapes-selector">
                    <div class="shape-options">
                        <label class="shape-option">
                            <input type="radio" name="bgShape" value="circle" checked>
                            <span class="shape-icon circle"></span>
                        </label>
                        <label class="shape-option">
                            <input type="radio" name="bgShape" value="square">
                            <span class="shape-icon square"></span>
                        </label>
                        <label class="shape-option">
                            <input type="radio" name="bgShape" value="triangle">
                            <span class="shape-icon triangle"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="settings-section">
                <h3 class="section-title">Layout de Inserci√≥n</h3>
                <div class="esql-upload-container">
                    <label for="esql-upload" class="btn-upload-esql">
                        <img src="styles/upload.png" alt="Subir .esql">
                        <span>Cargar Archivo .esql</span>
                    </label>
                    <input type="file" id="esql-upload" accept=".esql" style="display: none;">
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Ayuda -->
    <div id="helpModal" class="help-modal">
        <div class="help-content">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <div class="help-sidebar">
                <nav class="help-navigation">
                    <ul>
                        <li><a href="#introduccion" class="nav-item active">
                            <span class="nav-icon">üëã</span>
                            <span class="nav-text">Introducci√≥n</span>
                        </a></li>
                        <li><a href="#esquema-bd" class="nav-item">
                            <span class="nav-icon">üèóÔ∏è</span>
                            <span class="nav-text">Esquema BD</span>
                        </a></li>
                        <li><a href="#gestion-datos" class="nav-item">
                            <span class="nav-icon">üíæ</span>
                            <span class="nav-text">Gesti√≥n de Datos</span>
                        </a></li>
                        <li><a href="#visualizacion" class="nav-item">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Visualizaci√≥n</span>
                        </a></li>
                        <li><a href="#personalizacion" class="nav-item">
                            <span class="nav-icon">üé®</span>
                            <span class="nav-text">Personalizaci√≥n</span>
                        </a></li>
                        <li><a href="#faq" class="nav-item">
                            <span class="nav-icon">‚ùì</span>
                            <span class="nav-text">FAQ y Soporte</span>
                        </a></li>
                    </ul>
                </nav>
            </div>
            <div class="help-main">

                <section id="introduccion" class="help-section active">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>¬øQu√© es <span style="color:#9b4f96">ECO A SU MEMORIA</span>?</h2>
                        </div>
                        <div class="block-content">
                            <p>
                                <strong>ECO A SU MEMORIA</strong> es una aplicaci√≥n web pensada para simplificar y mejorar la gesti√≥n de los datos de casos de feminicidios en Espa√±a.
                            </p>
                            <div class="block-highlight">
                                <span class="block-badge">Hackat√≥n URV</span>
                                <p>
                                    El proyecto naci√≥ en una hackat√≥n de la <strong>Universitat Rovira i Virgili</strong>, con un equipo interdisciplinar.
                                </p>
                            </div>
                            <div class="block-highlight">
                                <span class="block-badge">Objetivo</span>
                                <p>
                                    Facilitar el trabajo de quienes recopilan, gestionan y analizan informaci√≥n sobre feminicidios, permitiendo una gesti√≥n centralizada, segura y eficiente.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Niveles de Acceso y Permisos</h2>
                        </div>
                        <div class="block-content">
                            <div class="access-cards">
                                <div class="access-card dev">
                                    <div class="access-title">üë®‚Äçüíª Desarrollador</div>
                                    <ul>
                                        <li>Control total sobre la estructura de la base de datos.</li>
                                        <li>Gesti√≥n completa de datos.</li>
                                        <li>Acceso a todas las funcionalidades.</li>
                                    </ul>
                                </div>
                                <div class="access-card admin">
                                    <div class="access-title">üõ†Ô∏è Administrador</div>
                                    <ul>
                                        <li>Gestionar inserciones (crear, editar, borrar).</li>
                                        <li>Visualizar y exportar datos.</li>
                                    </ul>
                                </div>
                                <div class="access-card externo">
                                    <div class="access-title">üëÄ Externo</div>
                                    <ul>
                                        <li>Visualizar datos, mapas y gr√°ficos de forma an√≥nima.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="esquema-bd" class="help-section">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Gesti√≥n del Esquema (Solo Desarrolladores)</h2>
                        </div>
                        <div class="block-content">
                            <p>La pesta√±a <strong>Esquema</strong> es el centro de control para la estructura de tu base de datos.</p>
                            <div class="feature-list">
                                <div class="feature-item">
                                    <h4>Crear Tablas</h4>
                                    <p>Usa el bot√≥n "Crear Tabla" para definir nuevas tablas, sus columnas y tipos de datos (Texto, N√∫mero, Fecha, Booleano, etc.).</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Crear Enums</h4>
                                    <p>Define listas de valores predefinidos (Enums) para usarlos como tipos de datos en tus tablas, garantizando la consistencia.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Relaciones</h4>
                                    <p>Crea relaciones entre tablas directamente desde el diagrama visual para conectar tus datos de forma l√≥gica.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="gestion-datos" class="help-section">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Inserci√≥n y Gesti√≥n de Datos</h2>
                        </div>
                        <div class="block-content">
                            <p>La aplicaci√≥n ofrece dos formas flexibles de introducir y modificar datos:</p>
                            <div class="feature-list">
                                <div class="feature-item">
                                    <h4>Formularios Din√°micos (Pesta√±a Inserciones)</h4>
                                    <p>Para cada tabla, se genera un formulario a medida. Ideal para a√±adir registros uno por uno de forma guiada.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Interfaz tipo Excel (Pesta√±a Excel Import)</h4>
                                    <p>Perfecta para inserciones masivas. Selecciona una tabla y a√±ade o modifica m√∫ltiples filas a la vez en una parrilla intuitiva.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Visualizaci√≥n y Borrado (Pesta√±a Datos)</h4>
                                    <p>Consulta todos los datos insertados en tablas, con opciones para buscar, filtrar y eliminar registros.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="visualizacion" class="help-section">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Visualizaci√≥n de Datos: Mapas y Gr√°ficos</h2>
                        </div>
                        <div class="block-content">
                            <p>Transforma tus datos en informaci√≥n visual y comprensible.</p>
                            <div class="feature-list">
                                <div class="feature-item">
                                    <h4>Mapas Interactivos (Pesta√±a Mapa)</h4>
                                    <p>Selecciona una tabla y una columna con coordenadas o nombres de lugares para visualizar tus datos geogr√°ficamente.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Gr√°ficos Din√°micos (Pesta√±a Gr√°ficos)</h4>
                                    <p>Elige una tabla, una columna y un tipo de gr√°fico (circular, barras, etc.) para analizar la distribuci√≥n de tus datos.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="personalizacion" class="help-section">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Personaliza tu Experiencia</h2>
                        </div>
                        <div class="block-content">
                            <p>Ajusta la apariencia de la aplicaci√≥n a tu gusto desde el panel de personalizaci√≥n (icono de paleta de colores).</p>
                            <div class="feature-list">
                                <div class="feature-item">
                                    <h4>Tema Oscuro y Claro</h4>
                                    <p>Activa el modo oscuro para una visualizaci√≥n m√°s c√≥moda en entornos con poca luz.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Animaciones</h4>
                                    <p>Activa o desactiva las animaciones de la interfaz, como el t√≠tulo flotante o las part√≠culas de fondo.</p>
                                </div>
                                <div class="feature-item">
                                    <h4>Layout de Inserci√≥n (.esql)</h4>
                                    <p>Los desarrolladores pueden subir un archivo <code>.esql</code> para definir un layout de inserci√≥n personalizado y m√°s complejo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="faq" class="help-section">
                    <div class="help-block visual-block">
                        <div class="block-header">
                            <h2>Preguntas Frecuentes y Soluciones</h2>
                        </div>
                        <div class="block-content">
                            <div class="faq-columns">
                                <div class="faq-column">
                                    <h4>Para Desarrolladores</h4>
                                    <div class="faq-item">
                                        <strong>Error: "La tabla ya existe"</strong>
                                        <p>Usa un nombre √∫nico o elimina la tabla existente antes de crearla.</p>
                                    </div>
                                    <div class="faq-item">
                                        <strong>Error: "Clave primaria duplicada"</strong>
                                        <p>El valor de la columna PK debe ser √∫nico para cada registro.</p>
                                    </div>
                                    <div class="faq-item">
                                        <strong>Error: "ENUM no v√°lido"</strong>
                                        <p>El valor que intentas insertar no est√° en la lista de opciones del ENUM. Debes a√±adirlo primero.</p>
                                    </div>
                                </div>
                                <div class="faq-column">
                                    <h4>Para Administradores y Usuarios</h4>
                                    <div class="faq-item">
                                        <strong>¬øPor qu√© no puedo editar el esquema?</strong>
                                        <p>Solo los perfiles de "Desarrollador" tienen permisos para modificar la estructura de la base de datos.</p>
                                    </div>
                                    <div class="faq-item">
                                        <strong>¬øQu√© hago si no aparece una opci√≥n en un desplegable?</strong>
                                        <p>Esa lista (ENUM) es fija. Contacta con un desarrollador para que a√±ada la nueva opci√≥n.</p>
                                    </div>
                                    <div class="faq-item">
                                        <strong>Los datos no aparecen en el mapa/gr√°fico.</strong>
                                        <p>Aseg√∫rate de que los datos est√©n bien insertados y que las columnas seleccionadas sean las correctas (ej. una columna de texto para un mapa).</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>
    <div class="background-circles"></div>
    <div class="title-container">
        <div class="bg-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
        <h1 id="titulin">easySQL</h1>
        <p class="subtitle">Gesti√≥n de Bases de Datos Simplificada</p>
    </div>
    <!-- Men√∫ de pesta√±as -->
    <div class="tab-menu">
        <button class="tab-button active" onclick="showTab('esquema')">Esquema</button>
        <button class="tab-button" onclick="showTab('inserciones')">Inserciones</button>
        <button class="tab-button" onclick="showTab('datos')">Datos</button>
        <button class="tab-button" onclick="showTab('consultas')">Consultas</button>
        <button class="tab-button" onclick="showTab('mapa')">Mapa</button>
        <button class="tab-button" onclick="showTab('graficos')">Gr√°ficos</button>
        <button class="tab-button" onclick="showTab('excelImport')">Excel Import</button>
    </div>
    <!-- Pesta√±a Esquema -->
    <div id="esquema" class="tab-content active">
        <div id="buttons-container">
            <button onclick="openCreateTableModal()">Crear Tabla</button>
            <select id="tableDropdown"></select>
            <button onclick="editTable()">Editar/Borrar Tabla</button>
            <button onclick="openCreateEnumModal()">Crear Enum</button>
            <select id="enumDropdown"></select>
            <button onclick="openDeleteEnumModal(document.getElementById('enumDropdown').value)">Borrar Enum</button>
            <button onclick="openEditEnumModal()">Editar Enum</button>
            <button onclick="downloadSQL()">Descargar SQL</button>
            <button onclick="document.getElementById('sqlFileInput').click()">Cargar SQL</button>
            <input type="file" id="sqlFileInput" style="display: none" accept=".sql" onchange="loadSQL(event)">
        </div>
        <h2 id="mapita">Mapa de Clases</h2>
        <div class="schema-layout">
            <div id="network"></div>
            <div class="predefined-enums-container">
                <h3>Enums Predefinidos</h3>
                <div id="predefinedEnumsList"></div>
            </div>
        </div>
    </div>
    <!-- Pesta√±a Inserciones -->
    <div id="inserciones" class="tab-content">
        <!-- El contenido se generar√° din√°micamente -->
    </div>
    <!-- Pesta√±a Datos -->
    <div id="datos" class="tab-content">
        <h2>Datos Insertados</h2>
        <div class="search-header">
            <h3>Buscar y filtrar</h3>
        </div>
        <div class="data-actions">
            <button onclick="downloadInsertions()">Descargar Inserciones</button>
            <button onclick="document.getElementById('insertionsFileInput').click()">Cargar Inserciones</button>
            <input type="file" id="insertionsFileInput" style="display: none" accept=".sql" onchange="loadInsertions(event)">
        </div>
        <div id="data-container"></div>
    </div>
    <!-- Pesta√±a Consultas -->
    <div id="consultas" class="tab-content">
        <h2>Consultas con IA</h2>
        <div class="ia-query-container">
            <div class="ia-input-group centered">
                <label for="apiKey">API Key de IA (ej. Gemini):</label>
                <input type="password" id="apiKey" placeholder="Pega tu API Key aqu√≠ para usar la IA">
            </div>
            <div class="ia-input-group centered">
                <label for="naturalQuery">Pregunta en lenguaje natural:</label>
                <textarea id="naturalQuery" rows="4" placeholder="Ej: ¬øCu√°ntas v√≠ctimas hab√≠a en Barcelona en 2023?"></textarea>
                <button onclick="generateAIQuery()">Generar Consulta SQL</button>
            </div>
            <div class="ia-input-group centered">
                <label for="generatedSql">Consulta SQL generada (editable):</label>
                <textarea id="generatedSql" rows="6" placeholder="Aqu√≠ aparecer√° la consulta SQL generada..."></textarea>
                <button onclick="executeGeneratedSQL()">Ejecutar Consulta</button>
            </div>
            <div class="ia-output">
                <label>Resultado de la consulta:</label>
                <pre id="sqlResult"></pre>
            </div>
        </div>
    </div>
    <!-- Pesta√±a Mapa -->
    <div id="mapa" class="tab-content">
        <div class="map-controls">
            <select id="mapaTableSelect">
                <option value="">Selecciona una tabla</option>
            </select>
            <select id="mapaColumnSelect" disabled>
                <option value="">Selecciona una columna</option>
            </select>
            <button onclick="actualizarMapa()">Actualizar Mapa</button>
        </div>
        <div id="mapaContainer" style="height: calc(100vh - 250px);"></div>
    </div>
    <!-- Pesta√±a Gr√°ficos -->
    <div id="graficos" class="tab-content">
        <div class="graficos-selectors">
            <select id="graficoTableSelect">
                <option value="">Selecciona una tabla</option>
            </select>
            <select id="graficoColumnSelect" disabled>
                <option value="">Selecciona una columna</option>
            </select>
            <select id="graficoTipoSelect">
                <option value="">Selecciona un tipo de gr√°fico</option>
                <option value="pie">Circular</option>
                <option value="semicircle">Semic√≠rculo</option>
                <option value="column">Barras</option>
                <option value="line">L√≠neas</option>
            </select>
            <button onclick="generarGrafico()">Generar Gr√°fico</button>
        </div>
        <div id="graficos-container">
            <!-- Aqu√≠ se insertar√°n los gr√°ficos din√°micamente -->
        </div>
    </div>
    <!-- Nueva pesta√±a Excel Import -->
    <div id="excelImport" class="tab-content">
        <div class="excel-import-controls">
            <select id="excelTableSelect" onchange="setupExcelGrid()">
                <option value="">Selecciona una tabla</option>
            </select>
            <input type="number" id="rowCount" min="10" max="1000" value="100" 
                title="N√∫mero de filas (10-1000)"
                style="width: 100px;"
                onchange="setupExcelGrid()">
            <button onclick="validateAndImportData()">Guardar Datos</button>
            <button onclick="loadExistingData()">Modificar Datos Ya Insertados</button>
            <button onclick="clearGrid()">Limpiar Todo</button>
        </div>
        <div id="excelGrid" class="excel-grid"></div>
    </div>
    <!-- Modal para crear tabla -->
    <div id="createTableModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateTableModal()">√ó</span>
            <h2>Crear Nueva Tabla</h2>
            <label for="tableName">Nombre de la tabla:</label>
            <input type="text" id="tableName" class="table-name-input" placeholder="ej. estudiantes"><br><br>
            <h3>Elementos (Columnas)</h3>
            <div id="columnsContainer"></div>
            <button onclick="addColumnInput()">A√±adir Elemento</button><br><br>
            <button onclick="createTableFromForm()">Crear Tabla</button>
        </div>
    </div>
    <!-- Modal para editar tabla -->
    <div id="editTableModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditTableModal()">√ó</span>
            <h2>Editar Tabla</h2>
            <h3>Elementos (Columnas)</h3>
            <div id="editColumnsContainer"></div>
            <button onclick="addColumnInputEdit()">A√±adir Elemento</button><br><br>
            <button onclick="saveTableChanges()">Guardar Cambios</button>
            <button onclick="deleteTableFromModal()">Borrar Tabla</button>
        </div>
    </div>
    <!-- Modal para crear enum -->
    <div id="createEnumModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateEnumModal()">√ó</span>
            <h2>Crear Nuevo Enum</h2>
            <label for="enumName">Nombre del Enum:</label>
            <input type="text" id="enumName" class="table-name-input" placeholder="ej. calidadTV"><br><br>
            <h3>Valores</h3>
            <div id="enumValuesContainer"></div>
            <button onclick="addEnumValueInputCreate()">A√±adir Valor</button><br><br>
            <button onclick="createEnumFromForm()">Crear Enum</button>
        </div>
    </div>
    <!-- Modal para editar enums -->
    <div id="editEnumModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditEnumModal()">√ó</span>
            <h2>Editar Enum</h2>
            <label for="editEnumName">Nombre del Enum:</label>
            <input type="text" id="editEnumName" class="table-name-input" readonly><br><br>
            <h3>Valores</h3>
            <div id="editEnumValuesContainer"></div>
            <button onclick="addEnumValueInput()">A√±adir Valor</button><br><br>
            <button onclick="saveEnumChanges()">Guardar Cambios</button>
        </div>
    </div>
    <!-- Modal para relaciones -->
    <div id="relationshipModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRelationshipModal()">√ó</span>
            <h2>Crear Relaci√≥n</h2>
            <label for="relationshipName">Nombre de la Relaci√≥n:</label>
            <input type="text" id="relationshipName" placeholder="ej. Relaci√≥n1"><br><br>
            <label for="relationshipTable1">Tabla 1:</label>
            <select id="relationshipTable1"></select><br><br>
            <label for="relationshipTable2">Tabla 2:</label>
            <select id="relationshipTable2"></select><br><br>
            <label for="relationshipType">Tipo:</label>
            <select id="relationshipType">
                <option value="1:1">1:1</option>
                <option value="n:1">n:1</option>
                <option value="1:n">1:n</option>
                <option value="n:n">n:n</option>
            </select><br><br>
            <label for="relationshipDirection">Direcci√≥n:</label>
            <select id="relationshipDirection">
                <option value="bidirectional">Bidireccional</option>
                <option value="forward">Hacia adelante</option>
                <option value="backward">Hacia atr√°s</option>
            </select><br><br>
            <button onclick="saveRelationship()">Guardar Relaci√≥n</button>
        </div>
    </div>
    <!-- Scripts -->
    <script src="scripts/notifications.js"></script>
    <script src="scripts/warningDialog.js"></script>
    <script src="scripts/main.js"></script>
    <script src="scripts/tableDataMigrator.js"></script>
    <script src="scripts/createTable.js"></script>
    <script src="scripts/editTable.js"></script>
    <script src="scripts/deleteTable.js"></script>
    <script src="scripts/editEnum.js"></script>
    <script src="scripts/createEnum.js"></script>
    <script src="scripts/insertions.js"></script>
    <script src="scripts/tabs.js"></script>
    <script src="scripts/dataView.js"></script>
    <script src="scripts/mapa.js"></script>
    <script src="scripts/graficos.js"></script>
    <script src="scripts/animations.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/excelImport.js"></script>
    <script src="scripts/predefinedEnums.js"></script>
    <script src="scripts/mapCoordinates.js"></script>
    <script src="scripts/colorTheme.js"></script>
    <script src="scripts/help.js"></script>
    <script src="eSQL/custom-insert.js"></script>
    <!-- A√±adir antes de cerrar el body -->
    <link rel="stylesheet" href="styles/insertions.css">
    <script src="scripts/labelScroller.js"></script>
    <script>
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.querySelector('.background-circles').innerHTML = '';
            }
        });
    </script>
    <style>
/* Estilos para el men√∫ de ayuda */
.help-navigation {
    background: linear-gradient(135deg, #f5edff 0%, #e4cdff 100%);
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.dark-mode .help-navigation {
    background: linear-gradient(135deg, #2a1f2d 0%, #382839 100%);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.help-navigation ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.nav-item {
    display: flex;
    align-items: center;
    justify-content: center;  /* Centra el contenido horizontalmente */
    padding: 1rem 1.5rem;
    margin: 0.5rem 0;
    background: #fff;
    border-radius: 12px;
    text-decoration: none;
    color: #7e3f7a;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(155,79,150,0.08);
    text-align: center;  /* Centra el texto */
}

.dark-mode .nav-item {
    background: #3a2950;
    color: #e4cdff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.nav-item:hover {
    transform: translateX(5px);
    background: #f8f2ff;
    box-shadow: 0 4px 12px rgba(155,79,150,0.12);
}

.dark-mode .nav-item:hover {
    background: #4a3960;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

.nav-item.active {
    background: #9b4f96;
    color: #fff;
}

.dark-mode .nav-item.active {
    background: #7e3f7a;
    color: #fff;
}

.feature-list {
    margin-top: 1.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.feature-item h4 {
    color: #9b4f96;
    margin-bottom: 0.5rem;
}

.feature-item p {
    font-size: 0.95rem;
    line-height: 1.6;
    color: #666;
}

.dark-mode .feature-item p {
    color: #ccc;
}

.faq-columns {
    display: flex;
    gap: 2rem;
}

.faq-column {
    flex: 1;
}

.faq-column h4 {
    color: #9b4f96;
    border-bottom: 2px solid #f5edff;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
}

.dark-mode .faq-column h4 {
    border-bottom-color: #3a2950;
}

.faq-item {
    margin-bottom: 1.5rem;
}

.faq-item strong {
    display: block;
    color: #7e3f7a;
    margin-bottom: 0.3rem;
}

.dark-mode .faq-item strong {
    color: #e4cdff;
}

.faq-item p {
    font-size: 0.9rem;
    line-height: 1.5;
    color: #666;
    margin: 0;
}

.dark-mode .faq-item p {
    color: #bbb;
}

/* Estilos para la nueva pesta√±a de Consultas con IA */
.ia-query-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    padding: 1rem;
}
.ia-input-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}
.ia-input-group.centered {
    align-items: center;
}
.ia-input-group.centered input,
.ia-input-group.centered textarea {
    width: 80%;
    max-width: 800px;
}
.ia-input-group.centered button {
    width: auto;
    align-self: center;
    margin-top: 0.5rem;
}
.column-order-buttons {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-left: 5px;
}
.move-col-btn {
    background: transparent;
    border: 1px solid var(--color-border);
    color: var(--color-primary);
    padding: 0;
    width: 24px;
    height: 16px;
    font-size: 10px;
    line-height: 10px;
    cursor: pointer;
    border-radius: 3px;
    transition: all 0.2s ease;
}
.move-col-btn:hover {
    background: var(--color-primary-light);
    border-color: var(--color-primary);
}
.move-col-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}
.column-input {
    transition: all 0.3s ease-in-out;
}
.ia-input-group label {
    font-weight: bold;
    color: var(--color-primary);
}
/* Estilos para el login */
.login-overlay {
    display: flex;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.login-container {
    background: #fff;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 400px;
    text-align: center;
}

.login-container h2 {
    margin-bottom: 1.5rem;
    color: #7e3f7a;
}

.login-field {
    margin-bottom: 1.2rem;
    text-align: left;
}

.login-field label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #333;
}

.login-field input {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.login-field input:focus {
    border-color: #7e3f7a;
    outline: none;
}

.login-button {
    width: 100%;
    padding: 0.8rem;
    background: #9b4f96;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s ease;
}

.login-button:hover {
    background: #7e3f7a;
}

.role-selector {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding: 0.5rem;
    background: #f5edff;
    border-radius: 8px;
}

.role-btn {
    flex: 1;
    padding: 0.8rem;
    border: none;
    border-radius: 6px;
    background: transparent;
    color: #7e3f7a;
    cursor: pointer;
    transition: all 0.3s ease;
}

.role-btn.active {
    background: #fff;
    color: #9b4f96;
    box-shadow: 0 2px 8px rgba(155,79,150,0.15);
}

.guest-access {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e7d0e6;
    text-align: center;
}

.guest-button {
    background: transparent;
    border: 2px solid #9b4f96;
    color: #9b4f96;
    padding: 0.7rem 1.5rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.guest-button:hover {
    background: #f5edff;
}

.tab-button.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}
</style>

<script>
// A√±adir interactividad al men√∫
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', function(e) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
    });
});

// Animaci√≥n al hacer scroll
const observerOptions = {
    threshold: 0.1
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
            // Asegura que los estilos del modo oscuro se apliquen correctamente
            if (document.body.classList.contains('dark-mode')) {
                entry.target.style.background = '#3a2950';
            }
        }
    });
}, observerOptions);

document.querySelectorAll('.static-faq').forEach(faq => {
    faq.style.opacity = '0';
    faq.style.transform = 'translateY(20px)';
    observer.observe(faq);
});

// L√≥gica de autenticaci√≥n
let currentRole = 'developer'; // Rol por defecto

document.querySelectorAll('.role-btn').forEach(button => {
    button.addEventListener('click', function() {
        document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        currentRole = this.getAttribute('data-role');
    });
});

function handleLogin(event) {
    event.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    // Aqu√≠ ir√≠a la l√≥gica de autenticaci√≥n real
    console.log(`Intento de acceso: ${username}, Rol: ${currentRole}`);

    // Simulaci√≥n de √©xito en el login
    setTimeout(() => {
        alert(`Bienvenido ${username}, has accedido como ${currentRole}`);
        closeLogin();
    }, 1000);
}

function accessAsGuest() {
    // L√≥gica para acceso como invitado
    alert('Has accedido como invitado');
    closeLogin();
}

function closeLogin() {
    document.getElementById('loginOverlay').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Abrir el login al cargar
window.onload = function() {
    document.body.style.overflow = 'hidden';
};

// L√≥gica para el bot√≥n de subir archivos .esql
document.getElementById('esql-upload').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            // Aqu√≠ ir√≠a la l√≥gica para procesar el contenido del archivo .esql
            console.log('Contenido del archivo .esql:', content);
        };
        reader.readAsText(file);
    }
});
</script>
</body>
</html>

